kind: job
metadata:
  name: open-archive
  tag: ''
  hash: 163a7bb9cbb9e6f8b0a21307dcb77e3690656f28
  project: ''
  labels:
    author: yaronh
  categories:
  - data-preparation
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCB6aXBmaWxlCmltcG9ydCB1cmxsaWIucmVxdWVzdAppbXBvcnQgdGFyZmlsZQppbXBvcnQganNvbgoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQoKZnJvbSB0eXBpbmcgaW1wb3J0IFVuaW9uCmltcG9ydCBib3RvMwpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgdXJscGFyc2UKCmRlZiBvcGVuX2FyY2hpdmUoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGFyY2hpdmVfdXJsOiBEYXRhSXRlbSwKICAgIHN1YmRpcjogc3RyID0gImNvbnRlbnQiLAogICAga2V5OiBzdHIgPSAiY29udGVudCIsCiAgICB0YXJnZXRfcGF0aDogc3RyID0gTm9uZSwKKToKICAgICIiIk9wZW4gYSBmaWxlL29iamVjdCBhcmNoaXZlIGludG8gYSB0YXJnZXQgZGlyZWN0b3J5CiAgICBDdXJyZW50bHkgc3VwcG9ydHMgemlwIGFuZCB0YXIuZ3oKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIGZ1bmN0aW9uIGV4ZWN1dGlvbiBjb250ZXh0CiAgICA6cGFyYW0gYXJjaGl2ZV91cmw6ICB1cmwgb2YgYXJjaGl2ZSBmaWxlIAogICAgOnBhcmFtIHN1YmRpcjogICAgICAgcGF0aCB3aXRoaW4gYXJ0aWZhY3Qgc3RvcmUgd2hlcmUgZXh0cmFjdGVkIGZpbGVzCiAgICAgICAgICAgICAgICAgICAgICAgICBhcmUgc3RvcmVkCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICBrZXkgb2YgYXJjaGl2ZSBjb250ZW50cyBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIHRhcmdldF9wYXRoOiAgZmlsZSBzeXN0ZW0gcGF0aCB0byBzdG9yZSBleHRyYWN0ZWQgZmlsZXMgKHVzZSBlaXRoZXIgdGhpcyBvciBzdWJkaXIsIHMzIGNhbiBiZSB1c2VkIHRvbykKICAgICIiIgogICAgCiMgICAgIAogICAgYXJjaGl2ZV91cmwgPSBhcmNoaXZlX3VybC5sb2NhbCgpCiMgICAgIHdoZW4gd29ya2luZyBvbiBDRSwgdGFyZ2V0IHBhdGggbWlnaHQgYmUgb24gczMKICAgIGlmIG9zLmVudmlyb24uZ2V0KCdNTFJVTl9DRScpIGFuZCAnczMnIGluICh0YXJnZXRfcGF0aCBvciBzdWJkaXIpOgogICAgICAgIGlmIG9zLmVudmlyb24uZ2V0KCdTM19FTkRQT0lOVF9VUkwnKToKICAgICAgICAgICAgY2xpZW50ID0gYm90bzMuY2xpZW50KCdzMycsIGVuZHBvaW50X3VybCA9IG9zLmVudmlyb24uZ2V0KCdTM19FTkRQT0lOVF9VUkwnKSkgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY2xpZW50ID0gYm90bzMuY2xpZW50KCdzMycpICAKICAgICAgICAgICAgCiAgICAgICAgaWYgYXJjaGl2ZV91cmwuZW5kc3dpdGgoImd6Iik6CiAgICAgICAgICAgIHdpdGggdGFyZmlsZS5vcGVuKGFyY2hpdmVfdXJsLCBtb2RlPSJyfGd6IikgYXMgcmVmOgogICAgICAgICAgICAgICAgZm9yIGZpbGVuYW1lIGluIHJlZi5uYW1lbGlzdCgpOgogICAgICAgICAgICAgICAgICAgIGRhdGE9cmVmLnJlYWQoZmlsZW5hbWUpCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LnB1dF9vYmplY3QoQm9keT1kYXRhLCBCdWNrZXQ9dXJscGFyc2UodGFyZ2V0X3BhdGgpLm5ldGxvYywgS2V5PWYne3VybHBhcnNlKHRhcmdldF9wYXRoIG9yIHN1YmRpcikucGF0aFsxOl19L3tmaWxlbmFtZX0nKQoKICAgICAgICBlbGlmIGFyY2hpdmVfdXJsLmVuZHN3aXRoKCJ6aXAiKToKICAgICAgICAgICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoYXJjaGl2ZV91cmwsICJyIikgYXMgcmVmOgogICAgICAgICAgICAgICAgZm9yIGZpbGVuYW1lIGluIHJlZi5uYW1lbGlzdCgpOgogICAgICAgICAgICAgICAgICAgIGRhdGE9cmVmLnJlYWQoZmlsZW5hbWUpCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LnB1dF9vYmplY3QoQm9keT1kYXRhLCBCdWNrZXQ9dXJscGFyc2UodGFyZ2V0X3BhdGgpLm5ldGxvYywgS2V5PWYne3VybHBhcnNlKHRhcmdldF9wYXRoIG9yIHN1YmRpcikucGF0aFsxOl19L3tmaWxlbmFtZX0nKQoKICAgICAgICAKICAgIGVsc2U6CiAgICAgICAgb3MubWFrZWRpcnModGFyZ2V0X3BhdGggb3Igc3ViZGlyLCBleGlzdF9vaz1UcnVlKQogICAgICAgIGlmIGFyY2hpdmVfdXJsLmVuZHN3aXRoKCJneiIpOgogICAgICAgICAgICB3aXRoIHRhcmZpbGUub3BlbihhcmNoaXZlX3VybCwgbW9kZT0icnxneiIpIGFzIHJlZjoKICAgICAgICAgICAgICAgIHJlZi5leHRyYWN0YWxsKHRhcmdldF9wYXRoIG9yIHN1YmRpcikKICAgICAgICBlbGlmIGFyY2hpdmVfdXJsLmVuZHN3aXRoKCJ6aXAiKToKICAgICAgICAgICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoYXJjaGl2ZV91cmwsICJyIikgYXMgcmVmOgogICAgICAgICAgICAgICAgcmVmLmV4dHJhY3RhbGwodGFyZ2V0X3BhdGggb3Igc3ViZGlyKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJ1bnN1cHBvcnRlZCBhcmNoaXZlIHR5cGUgaW4ge2FyY2hpdmVfdXJsfSIpCgogICAga3dhcmdzID0ge30KICAgIGlmIHRhcmdldF9wYXRoOgogICAgICAgIGt3YXJncyA9IHsidGFyZ2V0X3BhdGgiOiB0YXJnZXRfcGF0aH0KICAgIGVsc2U6CiAgICAgICAga3dhcmdzID0geyJsb2NhbF9wYXRoIjogc3ViZGlyfQogICAgICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3Qoa2V5LCAqKmt3YXJncyk=
    commands: []
    code_origin: https://github.com/daniels290813/functions.git#22f8cd33988d589f324177b6ad44ee2dda84a74f:/home/jovyan/data/functions/open_archive/open_archive.py
    origin_filename: /home/jovyan/data/functions/open_archive/open_archive.py
  entry_points:
    open_archive:
      name: open_archive
      doc: 'Open a file/object archive into a target directory

        Currently supports zip and tar.gz'
      parameters:
      - name: context
        type: MLClientCtx
        doc: function execution context
        default: ''
      - name: archive_url
        type: DataItem
        doc: 'url of archive file '
        default: ''
      - name: subdir
        type: str
        doc: path within artifact store where extracted files are stored
        default: content
      - name: key
        type: str
        doc: key of archive contents in artifact store
        default: content
      - name: target_path
        type: str
        doc: file system path to store extracted files (use either this or subdir,
          s3 can be used too)
        default: null
      outputs:
      - default: ''
      lineno: 14
  description: Open a file/object archive into a target directory
  default_handler: open_archive
  disable_auto_mount: false
  env: []
  preemption_mode: prevent
  affinity: null
  tolerations: null
  security_context: {}
verbose: false
